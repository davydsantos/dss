package eu.europa.dss.signature.policy.validation;

import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.security.cert.CertificateFactory;
import java.security.cert.TrustAnchor;
import java.security.cert.X509Certificate;
import java.util.Collections;

import javax.xml.bind.DatatypeConverter;

import org.bouncycastle.asn1.ASN1InputStream;
import org.bouncycastle.asn1.ASN1Primitive;
import org.bouncycastle.util.encoders.Base64;
import org.junit.Assert;
import org.junit.Test;

import eu.europa.dss.signature.policy.asn1.ASN1SignaturePolicy;
import eu.europa.esig.dss.cades.validation.CAdESSignature;
import eu.europa.esig.dss.x509.CertificateToken;

public class SignaturePolicyTest {
	
	public static byte[] CMS_SIGNATURE = DatatypeConverter.parseHexBinary("308006092a864886f70d010702a0803080020101310f300d06096086480165030402010500308006092a864886f70d0107010000a08207d9308207d5308205bda003020102020856da37b123ae16a6300d06092a864886f70d01010b05003075310b300906035504061302425231133011060355040a130a4943502d42726173696c31363034060355040b132d536563726574617269612064612052656365697461204665646572616c20646f2042726173696c202d20524642311930170603550403131041432053455241534120524642207632301e170d3136303632393231303030305a170d3139303632393231303030305a3081d6310b300906035504061302425231133011060355040a130a4943502d42726173696c31363034060355040b132d536563726574617269612064612052656365697461204665646572616c20646f2042726173696c202d2052464231153013060355040b130c52464220652d43504620413331143012060355040b130b28454d204252414e434f2931143012060355040b130b415220434f4d50524f5641313730350603550403132e4441565944205045524549524120444f204e415343494d454e544f2053414e544f533a333037373337363038333030820122300d06092a864886f70d01010105000382010f003082010a0282010100b40436a8107cb8c2ef5d07dff9e2ff79eb2d0688b06c6d8a1e39a786cca702cad27f011ebacd9e1bfffeb94c05d8be5840ad8ca1f30e8f5e002c9020319ace8f13bf87043acb4de24ba714cbc0e50e06dc338ca965a268b510d6ff8c3f40689dd7fd2e27f33cd35823b9ab89c65d15df962e0dddb10011c22b9d9f61df40c435c8cb554a9aebdf72b0a15fac242a433c812f95c4bd12884049f817be3a2f7c8097a8c2bd968e29a184c37d02c5c62c02fa69275906446842393a514ee893f82c1aea58e3f45181ca37bc6dbb4895eec0208de37535c113c58d4f95cf2b6308c0ed31d373cd154b020a389e3da747c08851c4b0f6aed6420c4e80b23cbfc907190203010001a38203053082030130819906082b0601050507010104818c308189304806082b06010505073002863c687474703a2f2f7777772e636572746966696361646f6469676974616c2e636f6d2e62722f636164656961732f73657261736172666276322e703762303d06082b060105050730018631687474703a2f2f6f6373702e636572746966696361646f6469676974616c2e636f6d2e62722f736572617361726662763230090603551d1304023000301f0603551d23041830168014b2a0c43d469e7cc8856c081e103294654670417330710603551d20046a306830660606604c0102030a305c305a06082b06010505070201164e687474703a2f2f7075626c69636163616f2e636572746966696361646f6469676974616c2e636f6d2e62722f7265706f7369746f72696f2f6470632f6465636c61726163616f2d7266622e7064663081f30603551d1f0481eb3081e8304aa048a0468644687474703a2f2f7777772e636572746966696361646f6469676974616c2e636f6d2e62722f7265706f7369746f72696f2f6c63722f73657261736172666276322e63726c3044a042a040863e687474703a2f2f6c63722e636572746966696361646f732e636f6d2e62722f7265706f7369746f72696f2f6c63722f73657261736172666276322e63726c3054a052a050864e687474703a2f2f7265706f7369746f72696f2e69637062726173696c2e676f762e62722f6c63722f5365726173612f7265706f7369746f72696f2f6c63722f73657261736172666276322e63726c300e0603551d0f0101ff0404030205e0301d0603551d250416301406082b0601050507030206082b0601050507030430819e0603551d11048196308193811944415659442e53414e544f5340444f43555349474e2e434f4da03d0605604c010301a03413323331303831393834333037373337363038333030303030303030303030303030303030303033323536303933305353505350a01e0605604c010305a015131330303030303030303030303030303030303030a0170605604c010306a00e130c303030303030303030303030300d06092a864886f70d01010b050003820201000c929c484e1b6ae0d6a2c493072f453cfc6210680bc36e2e892dd56ed4962c13de846f775c92610bdf4d1b14212856a93102568bc5d404cae9d58f1a572de9492babf0f8fa53861b8446245d40fd0858715fd1c061a72b692fe78683b4834da6e95b09f72d478a5578f7694b35eab6286d9b506a0debeaaaa879920e2c8db4f212dbffdcaf6f62fcd2464b0f18b4089a91bc778e07ed639aba6937eb7d15a483318de560bb4121e62d7cf04080038cce9202d72872e663977da92a94b4298be82dc165ceca2f5be81ccdb313fe2c0cf97614b23bc778d5fca84223be5e0650c2a46e607cc5fee4340b49ae32f1d3bd6824a80751c42020267658b27604a32c96a064d003f30e8672cf6c80a7193258e9a19ba03ee780ff9a460c3eead6beb3e2d08ed71967641ddd05cf6bd53a6f1f412da8cb0e0f5e87fdf9f59c5874efb2c07d41d55532d41a45aa19cd4c768ec8335a860c71832dbc698da3c622c4b0fac3c69e6a7e13730e529915eae5686e7c0dba47c52a411f4fe8e917295eee9ad012ecd608c47698d8352fcdd87381b8b0669b1bdf39e655f1020ec8adb19e922e28a24daf2453125295e75724bf3938613d89253d3da4da27f4aeb3b7e1c1cfb34b4dd8fc6d2886b33b936d2a5d47eec288e95a7e9c7c8461f5c875c08b46c52fcdbc412b3ad8cf8c92531e6402917b77ab24f64f25f1004aa4612769d70b209a1f318213ca308213c60201013081813075310b300906035504061302425231133011060355040a130a4943502d42726173696c31363034060355040b132d536563726574617269612064612052656365697461204665646572616c20646f2042726173696c202d20524642311930170603550403131041432053455241534120524642207632020856da37b123ae16a6300d06096086480165030402010500a08201ad301806092a864886f70d010903310b06092a864886f70d010701302f06092a864886f70d010904312204209736e14845b6a7e525d0246950f1f6c6ad745616f878ac06854a949219456891308199060b2a864886f70d010910020f3181893081860607604c0107010b01302f300b06096086480165030402010420501d69b4b71fc6e57323c2c74131a9c8c62409be378ba788dc288555611b9e58304a3048060b2a864886f70d01091005011639687474703a2f2f706f6c6974696361732e69637062726173696c2e676f762e62722f50415f50416445535f41445f52425f76315f302e6465723081c3060b2a864886f70d010910022f3181b33081b03081ad3081aa0420f5adde9792a56c8c5ff3872560e3e85221e62d7a517dad428d623299ccef373b3081853079a4773075310b300906035504061302425231133011060355040a130a4943502d42726173696c31363034060355040b132d536563726574617269612064612052656365697461204665646572616c20646f2042726173696c202d20524642311930170603550403131041432053455241534120524642207632020856da37b123ae16a6300d06092a864886f70d01010b05000482010036346f5d6f812d4d205d8f036a1cefb14203b1e36709ccd92c877cd488649ecb85197e35d2e554342719fa4aca936101a639a36661e0199218e5d535d2a30150fa1f209e252e772e20b1a8d960365797cb7371c82d9ceb363a629990eab667eb4a47805904b83f54a2f439098b90f82e86e343e58d8dcff6cd2acb89489f6b522164bb1541b5d83d0c231a47cd492432dbb4f5a6f0c3ab78951c96b6014a686280646d2b3c026f8df363c58c703dfc0d5117ab6fef34b5167a524ac8efaf95b77d25f8476d25415661a14c76b8ac3d6a258216446fd2a63587983859c08af87b7a02d0fa059e1f0bbd7f510f337332ad65c410482dd3482b029f6561c2371a5ba182106830821064060b2a864886f70d010910020e318210533082104f06092a864886f70d010702a08210403082103c020103310f300d060960864801650304020105003082017b060b2a864886f70d0109100104a082016a04820166308201620201010607604c0102822f063031300d06096086480165030402010500042003682b5d2e47480f78caeaecd228724bf2881510cb1a5af404641ac7906a9ba1020658adac2a26f1181332303137303431323232303430332e3139335a3004800201f40208d658f3b1044c5f42a081f3a481f03081ed310b300906035504061302425231133011060355040a140a4943502d42726173696c312b3029060355040b1422417574656e74696361646f20706f722041432043657274697369676e2054656d706f311b3019060355040b1412417373696e6174757261205469706f20543331273025060355040b141e6e436970686572204453452045534e3a443639392d443033382d443531453131302f060355040b14284175746f72696461646520646520436172696d626f20646f2054656d706f2043657274697369676e312330210603550403131a54696d655374616d7030312e443639392d443033382d44353145a0820bc93082083c30820624a00302010202102998925eaf8208d46fb41710a301b270300d06092a864886f70d01010b05003071310b300906035504061302425231133011060355040a130a4943502d42726173696c312d302b060355040b132443657274697369676e20436572746966696361646f7261204469676974616c20532e412e311e301c0603550403131541432043657274697369676e2054656d706f204731301e170d3137303232303030303030305a170d3231303732353233353935395a3081ed310b300906035504061302425231133011060355040a140a4943502d42726173696c312b3029060355040b1422417574656e74696361646f20706f722041432043657274697369676e2054656d706f311b3019060355040b1412417373696e6174757261205469706f20543331273025060355040b141e6e436970686572204453452045534e3a443639392d443033382d443531453131302f060355040b14284175746f72696461646520646520436172696d626f20646f2054656d706f2043657274697369676e312330210603550403131a54696d655374616d7030312e443639392d443033382d4435314530820122300d06092a864886f70d01010105000382010f003082010a02820101009b426a08028640adca9654a5b109888a8f08ecce7b83a8e19820d5aac501430d342ef6eb1831ff966d5bed6a4aff2ed10c262d2ec63363e6fb30cc19fcd57a726cde691f03255c54d26490d70591fcc4fad43335aacda18e1aae39d5af21147615f15102a0448cd44227aa5f441877684256e46aef0b253a6fef57907575120d8bc599651f7450408f2b7811b67757f6e3da8bc835371dde2cacef8ae036b10794b6b53878abaf945fbcc01040419c4ace0481b4516110f4ebdad627f396f71c266b7cfbeec1a79d147dabaabab89de5557b69809ff218a5efe81806273d90901d7a493dde24368878866b015dbddd50f3a25a31c1033f0a46f1ecac58d27c910203010001a38203513082034d3081b80603551d110481b03081ada02a0605604c010308a021041f43455254495349474e20434552544946494341444f5241204449474954414ca0190605604c010303a010040e3031353534323835303030313735a0250605604c010302a01c041a4c454f4e4152444f2050455245495241204755494d4152414553a03d0605604c010304a0340432323830363139373830373834313630373735303030303030303030303030303030303030313037303033393331494650524a30090603551d1304023000301f0603551d230418301680144ec7f2b8a3b281d5e0bfe3c4b8a7d3e4ed604634300e0603551d0f0101ff0404030205e0308201160603551d1f0482010d308201093057a055a0538651687474703a2f2f6963702d62726173696c2e63657274697369676e2e636f6d2e62722f7265706f7369746f72696f2f6c63722f414343657274697369676e54656d706f2f4c617465737443524c2e63726c3056a054a0528650687474703a2f2f6963702d62726173696c2e6f757472616c63722e636f6d2e62722f7265706f7369746f72696f2f6c63722f414343657274697369676e54656d706f2f4c617465737443524c2e63726c3056a054a0528650687474703a2f2f7265706f7369746f72696f2e69637062726173696c2e676f762e62722f6c63722f43657274697369676e2f414343657274697369676e54656d706f2f4c617465737443524c2e63726c3081840603551d20047d307b30790607604c0102822f06306e306c06082b060105050702011660687474703a2f2f6963702d62726173696c2e63657274697369676e2e636f6d2e62722f7265706f7369746f72696f2f6470632f41435f43657274697369676e5f54656d706f2f4450435f41435f43657274697369676e5f54656d706f2e70646630160603551d250101ff040c300a06082b0601050507030830819a06082b0601050507010104818d30818a305e06082b060105050730028652687474703a2f2f6963702d62726173696c2e63657274697369676e2e636f6d2e62722f7265706f7369746f72696f2f636572746966696361646f732f41435f43657274697369676e5f54656d706f2e703763302806082b06010505073001861c687474703a2f2f6f6373702e63657274697369676e2e636f6d2e6272300d06092a864886f70d01010b0500038202010099111ffd0c9785d0ec3d47f16edc982255fecb213d348f3b5da536b98aa565a7d7b7c1c212f616fa18b0c9dcef0b8ac9888013872c9cd019a84d3f4e8c0cf97fb22ce4ca077b2cdc60a3f6f6e3989e4ac08ab6c75cd69cc1fe50110d318f1ff4c7c625a94cee6ee1fe746899b283d8481ecb3b8d2e4d4fd2938449cca21f6ef3a038403b51e551d12dca0dec92e370e730214058dccd6c687dba738ed5df74c7b94e633f60a24123668453184a39cb2463168583f572bc14a63817004c305b30fdb7c90f2f4a0d3a24e9692f37b0f4cd91ff94f6a6f4bbd6e6960b0185d23f4cb685e25ebf6ee0c8bb3737d7fcee1270338638fda32d860a76fda168adb0a2f53922d61e0c0be0018dbf57ac56d1d12e79cc4a21ae717a8eb260a0d61c6fb1a5d8a2031e20bece0e2ba5b31a2b7b96a5ff9ac5695fb1077e07f6ca0b13da5222442f40a6a9459dd7948ab20bcca9803be97a6ef13581e6606b76b42ea3d2bb85422c8284516464d4c7a3203802874e993586f7941a592be5756c1f4c0bb74a4b8f42009938535788a2af0d7fd6cb147808772b4b27b085ffabe70d1e1dc069b6e4aa7fc53531cc9c20ed9f20828e5d8084f1cdd191f92410fc3a68a9bf1760984f68fd7af3fe8a4977e6504260f00d276bec0435e6bca64669530a867f1fcad4ba7e280f8e089dd0db571d24001af19ff5a2894ccb5880859a5c4fae2b0aa02ea18203853082026d0201013082011da181f3a481f03081ed310b300906035504061302425231133011060355040a140a4943502d42726173696c312b3029060355040b1422417574656e74696361646f20706f722041432043657274697369676e2054656d706f311b3019060355040b1412417373696e6174757261205469706f20543331273025060355040b141e6e436970686572204453452045534e3a443639392d443033382d443531453131302f060355040b14284175746f72696461646520646520436172696d626f20646f2054656d706f2043657274697369676e312330210603550403131a54696d655374616d7030312e443639392d443033382d44353145a2250a0101300906052b0e03021a0500031500790b31cf097e22c94d17b28abaa232fc78de2a08a08199308196a48193308190310b300906035504061302425231133011060355040a130a4943502d42726173696c310c300a060355040b1303495449313d303b060355040b13344175746f72696461646520436572746966696361646f726120646120507265736964656e6369612064612052657075626c696361311f301d0603550403131665617430332e69637062726173696c2e676f762e6272300d06092a864886f70d01010b0500020500dc9914e03022180f32303137303431323231303433325a180f32303137303431333231303433325a3071303a060a2b0601040184590a0401312c302a300a020500dc9914e00201003007020100020244e030070201000202654c300a020500dc9a66600201003033060a2b0601040184590a04023125302330090607604c0102822f06a00a3008020100020307a120a10a3008020100020307a120300d06092a864886f70d01010b050003820101006cc4c3386cf4defe3af4b6df613bdc840bbf9986a08d3c0022bd3c48f13419d63a665b18a5bfbe1657cfdb49e05fe5ca787aa39c702d885e9af3e359b1d536db334c55484c03527ba2be3d46df99528119129f7ed33f041185244c4a79896a280caf74b00326e73b2946742f4224dc3f3913f228147d8db13302383043dba79a7f7b4f9e0828ccfd753fe2ccb93f259460fb2858397cd3d48ebd0318ffd5120130d24924ce9ecf2079d43f54eb447f6234a763f8b3eafb75965922ded806b14ebfa4a76659cc4aa6364ed2b73753be1dc5895c5ba433aac4a80dd914986d051b932edf634b1360c9dbe2d46a2c2774249a5ccf27fdecd7febb01bd0a51d56971318202d8308202d40201013081853071310b300906035504061302425231133011060355040a130a4943502d42726173696c312d302b060355040b132443657274697369676e20436572746966696361646f7261204469676974616c20532e412e311e301c0603550403131541432043657274697369676e2054656d706f20473102102998925eaf8208d46fb41710a301b270300d06096086480165030402010500a0820123301a06092a864886f70d010903310d060b2a864886f70d0109100104302f06092a864886f70d010904312204200615e5e9473bc9d316449c6d9da3d7d277ada7562ae230374079b0912d4d99ed3081d3060b2a864886f70d010910020c3181c33081c03081bd3081a20414790b31cf097e22c94d17b28abaa232fc78de2a083081893075a4733071310b300906035504061302425231133011060355040a130a4943502d42726173696c312d302b060355040b132443657274697369676e20436572746966696361646f7261204469676974616c20532e412e311e301c0603550403131541432043657274697369676e2054656d706f20473102102998925eaf8208d46fb41710a301b270301604144300e1e0171bea4a82a7d1ce574550ab6eca134f300d06092a864886f70d01010b05000482010099db6b344d688b03da7662f76f0822276f91583864f5500e8e9e9b22ad12badc07703d45452d14fa09e04558ee5de5ca944d4e778d691592219109a7e605dd13afda8817677981872c7a3d1f58b92ee454dc12856f265e41e3dbe62f711b34709fb520e65c3140efd8a6a29c28b7943b5d2aa0b83a1052d7a832a6ca2158fcf78786697ac35293c3330acf23a122f3da488b61f03b3d0abf28ddf2f029bdca5bab88818b2d6d71f1eca5a5f498c58cf4f03673b8dccee903e16f6d0acc963e00121cc83cce7869b16a1aee3f87c3296f751274eb086ab41a1eeaa1bc8cf1f3158eeaf0a00dc591911ecf1ab06eb94efac53bfafa5c855cfe5c5ec5014e309d6f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
	public static byte[] CMS_SIGNATURE_ROOT = DatatypeConverter.parseHexBinary("308206A130820489A003020102020101300D06092A864886F70D01010D0500308197310B300906035504061302425231133011060355040A130A4943502D42726173696C313D303B060355040B1334496E7374697475746F204E6163696F6E616C206465205465636E6F6C6F67696120646120496E666F726D6163616F202D20495449313430320603550403132B4175746F72696461646520436572746966696361646F7261205261697A2042726173696C65697261207632301E170D3130303632313139303435375A170D3233303632313139303435375A308197310B300906035504061302425231133011060355040A130A4943502D42726173696C313D303B060355040B1334496E7374697475746F204E6163696F6E616C206465205465636E6F6C6F67696120646120496E666F726D6163616F202D20495449313430320603550403132B4175746F72696461646520436572746966696361646F7261205261697A2042726173696C6569726120763230820222300D06092A864886F70D01010105000382020F003082020A0282020100BA46A40EDDE740F2B5A07C52955745FC6D84F38601C98503AD98ABD2F25E0599C9BB6F6267FD7744B903073CD21B0062D4702C42837966AB9956AE81BC6A49BDF3740F62B7EB5B07669442249D46AC9A421830F024A85141EAAB95F1A82B027869B529275E9C2E73C6FE23A5E3A6CEFD6C1B6B0054EB00AD4F3A4C3CE70A885BDA5E9A0B56E4B554381DF20A93644EC3419253202ACFFC746ED4DB333862E4FE8E4C581CF78F2A4DFFC592D90952BDCF70009D699A336A888745219916510D34DF82BDB469A87C7CD4DDD3F2155C4BC55810EA8519CB3622582A720C9A96DECACF085161BFB40529062B8690FEE94DC3040547CBCF76D97F71A6877B1540E4338078071DA4F28E9B403BC97250DF69BEF02C961F90B5D5AE74E365B48C1AE96A1BFB725CC58254EAE05307C4CC12E9F7DED72FD4482F473F266104B1129A336BB5864B132BD0869D47ED69FBFC841266F856E50E8A6C76C46B1A7AC2A05A12D1238958017C0858DA158E15D97E7D37B6A445F50385CC47FA8B7945B8666233D3264ADE1CE9D47FE66D26B93C7DCD0F280A290F9BDD63ABB9A6471A84D785A4036506044B528D8334427F318E112EE6B36795407E977A4000F9116C833858AD03335BA6C4C1C5B0AC0DA906F0A6690134B6E9F894484F3EA67509EC4AC53BE0C95EB032FF9F6959CF3C306F0DCE2757EC5A1B68FFEC4F6F78323E79C5B45D957F0203010001A381F53081F2304E0603551D200447304530430605604C010100303A303806082B06010505070201162C687474703A2F2F61637261697A2E69637062726173696C2E676F762E62722F44504361637261697A2E706466303F0603551D1F043830363034A032A030862E687474703A2F2F61637261697A2E69637062726173696C2E676F762E62722F4C435261637261697A76322E63726C301F0603551D230418301680140C39203AB7011FCBD7287D41A0C7FA4AAD3224BE301D0603551D0E041604140C39203AB7011FCBD7287D41A0C7FA4AAD3224BE300F0603551D130101FF040530030101FF300E0603551D0F0101FF040403020106300D06092A864886F70D01010D05000382020100599A1469186D7D2943707D769B61DF778E1A76E4A9D6CB76A4160C4C9412C690D18103C5AD06D92D44BCB20976098039670018346D060AE6B5105948BA7560FC3F8E1D1855702B9E4B95AC89AB0A77247B61C4C791268E46135137B68C270AD30DF09A2B228383B3BD8335AD9B3CBC788329356136F8117133205463534501D8135A843BD7661324B7C446C522D87324EE1C131796C825E81B1ECFDF85506D3CEAF7509E1B97DEA76BDBD673D2CF7C50C0B08CE553127A8639AC355B67C7EAD4FBD1C25DEA0E977398AE29BFE43AF30436502CEDDE1EDB85E81D8409EEF3A683335B6F47794F48B5FCB82613ABAAB3F46111FB4567F31D3E6EFE2A4B26441A9FB1A2E03CDAE0E4053A78ACFBA8A14DBF5D2C772990CD131DEF0628D8B714F35BC8C99EA77E31128A7862C4D105BC060263042B0D89DDE45C5B328044D442EC2AF3F2408731D53EE20A320C148DD5726D0BE6FD8DE4A8F3058D7517779B0AB9FA9092996588326743058E2D0B15BB35F161E8D96777ED16E5E8012D6B343F8E83B3F7EA0F4A1E3E35849D8C80343FA995E8C3ADC4CD9ECA14162C199EE4368BB9B9A34225073EC3E5D5684FA0661CA6B3B6731C901A3F40B91A56427087FF6F2D0F11FD1EFFF78530150EE31731EE2795CCC9E9991E97C76D5B07B5056A3DF245DFBA827924702E9B821F66A9A56D27CCF62AA2D15F856FE0469DAAD2A54E550E");

	
	@Test
	public void testReadFullPolicy() throws IOException {
		Path path = Paths.get(new File("src/test/resources/PA_PAdES_AD_RB_v1_0.der").toURI());
		byte[] policyContents = Files.readAllBytes(path);
		try (ASN1InputStream is = new ASN1InputStream(policyContents)) {
			ASN1Primitive asn1SP = is.readObject();
			ASN1SignaturePolicy.getInstance(asn1SP);
		}
	}
	
	@Test
	public void testWriteFullPolicyMatchesReadValue() throws IOException {
		Path path = Paths.get(new File("src/test/resources/PA_PAdES_AD_RB_v1_0.der").toURI());
		byte[] policyContents = Files.readAllBytes(path);
		try (ASN1InputStream is = new ASN1InputStream(policyContents)) {
			ASN1Primitive asn1SP = is.readObject();
			ASN1SignaturePolicy signaturePolicy = ASN1SignaturePolicy.getInstance(asn1SP);
			byte[] encoded = signaturePolicy.getEncoded();
			
			String original = Base64.toBase64String(policyContents);
			String generated = Base64.toBase64String(encoded);
			
			Assert.assertEquals(original, generated);
		}
	}
	
	@Test
	public void testBuildCertPath() throws Exception {
		CAdESSignature sig = new CAdESSignature(CMS_SIGNATURE);
		
		// Emulate DSS cert path building
		loadIssuers(sig.getSigningCertificateToken(), sig.getCertPool());
		boolean foundAnchor = false;
		for(CertificateToken tk = sig.getSigningCertificateToken(); tk != null; tk = tk.getIssuerToken()) {
			if (tk.isSelfSigned()) {
				foundAnchor = true;
				break;
			}
		}
		Assert.assertTrue(foundAnchor);

		sig = new CAdESSignature(CMS_SIGNATURE, sig.getCertPool());
		X509Certificate trustedCert = (X509Certificate) CertificateFactory.getInstance("X509").generateCertificate(new ByteArrayInputStream(CMS_SIGNATURE_ROOT));
		FullCAdESSignaturePolicyValidator.getCertificateFullPath(
				sig.getSigningCertificateToken(), 
				Collections.singleton(new TrustAnchor(trustedCert, null)));
	}
}
